<div class="msg-page">
  <div class="msg-profile-container">
    <p>Your dressmaker</p>
    <h3><%= @order.dressmaker.first_name %> <%= @order.dressmaker.last_name %></h3>
    <div class="msg-avatar">
      <%= cl_image_tag @order.dressmaker.avatar_url, crop: :fill, class: "avatar-large" %>
    </div>
    <table class="table table-hover">
      <thead>
        <tr>
          <th scope="col" id="table-item">Item</th>
          <th scope="col" id="table-value"><%= @order.order_reference %></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row">Status</th>
          <td><%= @order.status %></td>
        </tr>
        <tr>
          <th scope="row">Expected Date</th>
          <td><%= @order.completion_date %></td>
        </tr>
        <tr>
          <th scope="row">Details</th>
          <td><%= @order.order_details %></td>
        </tr>
        <tr>
          <th scope="row">Fabric</th>
          <td><%= @order.fabric %></td>
        </tr>
        <tr>
          <th scope="row">Measures (cm)</th>
          <td> Chest: <%= @order.dimension_chest %> /
            Waist: <%= @order.dimension_waist %> /
            Hips: <%= @order.dimension_hips %> /
            Length: <%= @order.dimension_length %>
          </td>
        </tr>
        <tr>
          <th scope="row">Price</th>
          <td><%= @order.price %></td>
        </tr>
      </tbody>
    </table>

    <!-- Add alert: Are you sure? -->
    <div class="msg-btn-group">
      <button class="btn btn-danger msg-btn" id="edit">Edit</button>
      <button class="btn btn-success msg-btn hidden" action="/orders/<%= @order.id %>" id="save" data-method="patch" data-remote="true">Save</button>

      <%= button_to "Save", order_path(@order), method: :patch, class: "btn btn-success msg-btn hidden", id: "save", remote: true %>
      <%= button_to("Confirm", order_path(@order), method: :get, :class => "btn btn-danger msg-btn") %>
    </div>
  </div>

  <div class="msg-container">
    <h3> Contact your dressmaker </h3>

    <%= form_for [@order, @message], html: {class: "form-group form-inline"} do |f| %>
      <%= f.text_area :content, cols: 80, rows: 5, class: "form-control" %>
      <%= f.text_field :user_id, value: current_user.id, type: "hidden" %>
      <%= f.submit "Send", class: "form-control btn btn-danger msg-btn" %>
    <% end %>

    <% @order.messages.reverse.each do |message| %>
      <!-- if sender(user_id) of a message is current user, displays the message on right -->
      <% if message.user == current_user %>
        <div class="past-msg-right">
          <div class="msg-content">
            <div class="msg-box"><%= message.content %></div>
            <p><%= message.created_at %></p>
          </div>
          <%= cl_image_tag current_user.avatar_url, crop: :fill, class: "avatar-small" %>
        </div>
      <% else %>
        <div class="past-msg">
          <!-- should change depeding on user/dm -->
          <%= cl_image_tag @order.dressmaker.avatar_url, crop: :fill, class: "avatar-small" %>
          <div class="msg-content">
            <div class="msg-box"><%= message.content %></div>
            <p><%= message.created_at %></p>
          </div>
        </div>
      <% end %>
    <% end %>

  </div>
</div>
